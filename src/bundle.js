(()=>{var e={536:(e,t,n)=>{var r=n(55);e.exports=function(e){var t,n="",s=e||{};return function(e){n=n+'<div class="item__film-card"'+r.attr("id","top"+e.id,!0,!0)+r.attr("href",e.href,!0,!0)+'><div class="item__image"><img'+(r.attr("src",e.movieAvatar,!0,!0)+r.attr("alt",e.alt,!0,!0))+'></div><div class="item__details"><div class="item__film-card__title"><a href="#">'+r.escape(null==(t=e.title)?"":t)+'</a></div><div class="item__film-card__stars">'+r.escape(null==(t=e.stars)?"":t)+'</div><div class="item__film-card__description">'+r.escape(null==(t=e.description)?"":t)+'</div><div class="item__film-card__buttons"><div class="item__button-title">Смотреть</div></div></div></div>'}.call(this,"i"in s?s.i:"undefined"!=typeof i?i:void 0),n}},851:(e,t,n)=>{n(55),e.exports=function(e){return""+'<div class="item__suggestion-bar"><div class="item__suggestion-button"><div class="items__container"><img class="item__image" src="../../assets/subscription.png" alt=""><div class="item__title">Оформить подписку</div></div></div><div class="item__suggestion-button"><div class="items__container"><img class="item__image" src="../../assets/findmedia.png" alt=""><div class="item__title">Подборка медиа</div></div></div></div>'}},238:(e,t,n)=>{var r=n(55);e.exports=function(e){var t,n="",s=e||{};return function(e){n=n+'<div class="item__internal"'+r.attr("id","suggest"+e.id,!0,!0)+'><img class="item__suggestion__image"'+r.attr("src",e.movieAvatar,!0,!0)+r.attr("alt",e.alt,!0,!0)+'><div class="item__suggestion__title"><a href="#">'+r.escape(null==(t=e.title)?"":t)+'</a></div><div class="item__suggestion__status"><div>'+r.escape(null==(t=e.status)?"":t)+"</div></div></div>"}.call(this,"i"in s?s.i:"undefined"!=typeof i?i:void 0),n}},889:(e,t,n)=>{n(55),e.exports=function(e){return""+'<div class="line-underheader"></div>'}},237:(e,t,n)=>{var r=n(55);e.exports=function(e){var t,s="",i={},a=e||{};return function(a,o,l,u){const c=[];o&&c.push({className:"",href:"/profile",title:"Профиль",alt:""},{className:"js-logout-page",href:"",title:"Выйти",alt:""});const d=[{className:"homePage js-home-link",href:"/home",title:"Главная"},{className:"filmPage js-films-link",href:"/movies",title:"Фильмы"},{className:"serialsPage js-serials-link",href:"/serials",title:"Сериалы"},{className:"lastPage js-latest-link",href:"/last",title:"Последнее"}];s+='<header><a class="homePage js-home-link header-logo" href=""><img src="../../assets/RediotekaLogo.png" alt=""></a><ul class="header-form">',function(){var e=d;if("number"==typeof e.length)for(var n=0,i=e.length;n<i;n++){var a=e[n];s=s+"<li><a"+r.attr("href",a.href,!0,!0)+">"+r.escape(null==(t=a.title)?"":t)+"</a></li>"}else for(var n in i=0,e)i++,a=e[n],s=s+"<li><a"+r.attr("href",a.href,!0,!0)+">"+r.escape(null==(t=a.title)?"":t)+"</a></li>"}.call(this),s+="</ul>",o?(s+='<div class="header-form__profile"><a class="header-form__profile__link item__right-link js-search-button"><img src="../../assets/search.png"></a><div class="dropdown-profile"><img class="dropdown-profile__image" src="../../assets/profileDropdown.png"><div class="dropdown-profile__content">',function(){var e=c;if("number"==typeof e.length)for(var n=0,i=e.length;n<i;n++){var a=e[n];s=s+"<a"+r.attr("class",r.classes(["item__dropdown-profile "+a.className],[!0]),!1,!0)+">"+r.escape(null==(t=a.title)?"":t)+"</a>"}else for(var n in i=0,e)i++,a=e[n],s=s+"<a"+r.attr("class",r.classes(["item__dropdown-profile "+a.className],[!0]),!1,!0)+">"+r.escape(null==(t=a.title)?"":t)+"</a>"}.call(this),s+="</div></div></div>"):s+='<div class="header-form__profile"><a class="header-form__profile__link" href="/search"><img src="../../assets/search.png"></a><a class="header-form__profile__link" href="/login"><img src="../../assets/unlogined.png"></a></div>',s=s+"</header>"+(null==(t=n(889).call(this,e))?"":t)+'<div class="content">',i.TopSlider=t=function(r){this&&this.block,this&&this.attributes,function(){var i=r;if("number"==typeof i.length)for(var a=0,o=i.length;a<o;a++)i[a],s+=null==(t=n(536).call(this,e))?"":t;else for(var a in o=0,i)o++,i[a],s+=null==(t=n(536).call(this,e))?"":t}.call(this)},i.BottomSlider=t=function(r){this&&this.block,this&&this.attributes,function(){var i=r;if("number"==typeof i.length)for(var a=0,o=i.length;a<o;a++)i[a],s+=null==(t=n(238).call(this,e))?"":t;else for(var a in o=0,i)o++,i[a],s+=null==(t=n(238).call(this,e))?"":t}.call(this)},s+='<div class="item__page-title">С наивысшим рейтингом</div><div class="container">',i.TopSlider(a),s=s+"</div>"+(null==(t=n(851).call(this,e))?"":t)+'<div class="item__page-title">Новые фильмы</div><div class="suggestion-film__list new_films">',i.BottomSlider(l),s+='</div><div class="item__page-title">Новые сериалы</div><div class="suggestion-film__list new_series">',i.BottomSlider(u),s+="</div></div>"}.call(this,"cardFilms"in a?a.cardFilms:"undefined"!=typeof cardFilms?cardFilms:void 0,"isAuthorized"in a?a.isAuthorized:"undefined"!=typeof isAuthorized?isAuthorized:void 0,"newFilms"in a?a.newFilms:"undefined"!=typeof newFilms?newFilms:void 0,"newSeries"in a?a.newSeries:"undefined"!=typeof newSeries?newSeries:void 0),s}},55:(e,t,n)=>{"use strict";var r=Object.prototype.hasOwnProperty;function s(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",i="",a=Array.isArray(t),o=0;o<e.length;o++)(n=s(e[o]))&&(a&&t[o]&&(n=l(n)),r=r+i+n,i=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var s in e)s&&e[s]&&r.call(e,s)&&(t=t+n+s,n=" ");return t}(e):e||""}function i(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)r.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function a(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var s=typeof t;return"object"!==s&&"function"!==s||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=l(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}t.merge=function e(t,n){if(1===arguments.length){for(var r=t[0],s=1;s<t.length;s++)r=e(r,t[s]);return r}for(var a in n)if("class"===a){var o=t[a]||[];t[a]=(Array.isArray(o)?o:[o]).concat(n[a]||[])}else if("style"===a){o=(o=i(t[a]))&&";"!==o[o.length-1]?o+";":o;var l=i(n[a]);l=l&&";"!==l[l.length-1]?l+";":l,t[a]=o+l}else t[a]=n[a];return t},t.classes=s,t.style=i,t.attr=a,t.attrs=function(e,t){var n="";for(var o in e)if(r.call(e,o)){var l=e[o];if("class"===o){n=a(o,l=s(l),!1,t)+n;continue}"style"===o&&(l=i(l)),n+=a(o,l,!1,t)}return n};var o=/["&<>]/;function l(e){var t=""+e,n=o.exec(t);if(!n)return e;var r,s,i,a="";for(r=n.index,s=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}s!==r&&(a+=t.substring(s,r)),s=r+1,a+=i}return s!==r?a+t.substring(s,r):a}t.escape=l,t.rethrow=function e(t,r,s,i){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&r||i))throw t.message+=" on line "+s,t;var a,o,l,u;try{i=i||n(835).readFileSync(r,{encoding:"utf8"}),a=3,o=i.split("\n"),l=Math.max(s-a,0),u=Math.min(o.length,s+a)}catch(n){return t.message+=" - could not read from "+r+" ("+n.message+")",void e(t,null,s)}a=o.slice(l,u).map((function(e,t){var n=t+l+1;return(n==s?"  > ":"    ")+n+"| "+e})).join("\n"),t.path=r;try{t.message=(r||"Pug")+":"+s+"\n"+a+"\n\n"+t.message}catch(e){}throw t}},835:()=>{}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{"use strict";n.d(r,{O:()=>U});const e=new class{constructor(){this._listeners={}}on(e,t){(this._listeners[e]||(this._listeners[e]=new Map)).set(t.name,t)}off(e,t){this._listeners[e]=this._listeners[e]?.delete(t.name)}emit(e,...t){this._listeners[e]?.forEach((e=>{e(...t)}))}};class t{constructor(e,{data:t={}}={}){this._data=t,this.eventBus=e}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends t{constructor(e,{data:t={}}={}){super(e,t),s(this,"render",(()=>{const e=puglatizer.views.LogIn.LogIn();U.innerHTML=e,this.setEventListeners()})),s(this,"setEventListeners",(()=>{const[e]=document.getElementsByTagName("form"),[t]=document.getElementsByClassName("have-acc__link"),n=t=>{t.preventDefault(),this.eventBus.emit("login:loginUser",e,document.getElementById("email").value,document.getElementById("password").value)},r=e=>{e.preventDefault(),this.eventBus.emit("login:removeEventListeners"),this.eventBus.emit("signup:render")};e?.addEventListener("submit",n),t?.addEventListener("click",r),this.eventBus.on("login:removeEventListeners",(()=>{e?.removeEventListener("submit",n),t?.removeEventListener("click",r)}))})),this.eventBus.on("login:render",this.render)}}const a=e=>{if(!e)return!1;const t=e.querySelectorAll(".input-wrapper__input");t.forEach((e=>{const t=document.getElementById(e.id+"Error");t&&(t.textContent="",e.classList.remove("input-wrapper__input_error"))}));let n=!0;return t.forEach((e=>{const t=document.getElementById(e.id+"Error");if(t){if(!e.value)return t.textContent="Это поле обязательно к заполнению",e.classList.add("input-wrapper__input_error"),void(n=!1);switch(e.id){case"email":return void(n&&=u(e,t));case"login":return void(n&&=o(e,t));case"password":return void(n&&=c(e,t));case"confirmPassword":return void(n&&=d(e,t));case"firstName":case"secondName":return void(n&&=l(e,t))}}})),n},o=(e,t)=>!!/^[a-zA-Z](.[a-zA-Z0-9]*)$/.test(e.value)||(t.textContent="Логин должен содержать только латинские буквы и цифры",e.classList.add("input-wrapper__input_error"),!1),l=(e,t)=>!!/^[a-zA-Zа-яА-Я'][a-zA-Zа-яА-Я-' ]+[a-zA-Zа-яА-Я']?$/.test(e.value)||(t.textContent="Некорректно введены данные",e.classList.add("input-wrapper__input_error"),!1),u=(e,t)=>!!/^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/.test(e.value)||(t.textContent="Введен некорректный email",e.classList.add("input-wrapper__input_error"),!1),c=(e,t)=>!(e.value.length<8||e.value.length>50)||(t.textContent="Пароль должен быть длиной от 8 до 50 символов",e.classList.add("input-wrapper__input_error"),!1),d=(e,t)=>{const n=document.getElementById("password").value;return e.value===n||(t.textContent="Пароли не совпадают!",e.classList.add("input-wrapper__input_error"),!1)},h="http://localhost:8081",m={pages:{main:"/",profile:"/profile"},api:{me:`${h}/api/me`,media:`${h}/api/media/movie/`,logout:`${h}/api/users/logout`,login:`${h}/api/users/login`,signup:`${h}/api/users/signup`,profile:`${h}/api/users/`,newSeries:`${h}/api/media/category/newSeries?limit=10&type=series`,newFilms:`${h}/api/media/category/newFilms?limit=10&type=movie`,topFilmsAndSeries:`${h}/api/media/category/top?limit=5`}},v=e=>{const t=[];return e.reduce(((e,n)=>{t.push({id:n.id,title:n.title,movieAvatar:`${h}${n.movie_avatar}`,status:n.is_free?"Бесплатно":"Подписка",href:`/movie/${n.id}`})})),t},p=async({url:e,method:t,body:n}={})=>{const r=await fetch(e,{method:t,body:n,mode:"cors",credentials:"include"}),s=await r.json();return{status:r.status,parsedJson:s}},g=async()=>{const e={url:m.api.me,method:"GET",credentials:"include"};try{const{status:t,parsedJson:n}=await p(e);return 200===t?n.id:null}catch(e){return null}};class f{constructor(e){var t,n;n=(e,t,n)=>{a(e)&&(async(e,t)=>{if(!e||!t)return!1;const n={url:m.api.login,method:"POST",body:JSON.stringify({email:e,password:t})};try{return 200===(await p(n)).status}catch(e){return!1}})(t,n).then((e=>{e?(this.eventBus.emit("login:removeEventListeners"),this.eventBus.emit("homepage:render")):this.eventBus.emit("homepage:renderErrorPage")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))},(t="loginUser")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,this.eventBus=e,this.eventBus.on("login:loginUser",this.loginUser)}}const _=class{constructor(){}};class w{constructor(e){var t,n;n=(e,t,n,r,s)=>{a(e)&&(async(e,t,n,r)=>{if(!(e&&t&&n&&r))return!1;const s={url:m.api.signup,method:"POST",credentials:"include",body:JSON.stringify({username:e,email:t,password:n,confirm_password:r})};try{return 200===(await p(s)).status}catch(e){return!1}})(t,n,r,s).then((e=>{e?(this.eventBus.emit("signup:removeEventListeners"),this.eventBus.emit("homepage:render")):this.eventBus.emit("homepage:renderErrorPage")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))},(t="signUpUser")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,this.eventBus=e,this.eventBus.on("signup:signUpUser",this.signUpUser)}}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class E extends t{constructor(e,{data:t={}}={}){super(e,t),B(this,"render",(()=>{const e=puglatizer.views.SignUp.SignUp();U.innerHTML=e,this.setEventListeners()})),B(this,"setEventListeners",(()=>{const[e]=document.getElementsByTagName("form"),[t]=document.getElementsByClassName("have-acc__link"),n=t=>{t.preventDefault(),this.eventBus.emit("signup:signUpUser",e,document.getElementById("login").value,document.getElementById("email").value,document.getElementById("password").value,document.getElementById("confirmPassword").value)},r=e=>{e.preventDefault(),this.eventBus.emit("signup:removeEventListeners"),this.eventBus.emit("login:render")};e?.addEventListener("submit",n),t?.addEventListener("click",r),this.eventBus.on("signup:removeEventListeners",(()=>{e?.removeEventListener("submit",n),t?.removeEventListener("click",r)}))})),this.eventBus.on("signup:render",this.render)}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b{constructor(e){y(this,"getInfoAboutCurrentUser",(()=>{g().then((e=>{e?this.eventBus.emit("profile:getInfoForProfile",e):this.eventBus.emit("homepage:render")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))})),y(this,"getInfoForProfile",(e=>{(async e=>{if(!e)return null;const t={url:m.api.profile+e,method:"GET",credentials:"include"};try{const{status:e,parsedJson:n}=await p(t);return 200===e?n:null}catch(e){return null}})(e).then((t=>{if(t){const n={login:t.username,email:t.email,user_avatar:t.avatar??"img/user.png"};this.eventBus.emit("profile:renderProfileInfo",n),this.eventBus.emit("profile:setEventListeners",e)}else this.eventBus.emit("homepage:renderErrorPage")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))})),y(this,"updateAvatar",((e,t)=>{const[n]=t.files;if(n){const t=new FormData;t.append("avatar",n);const{avatarSrc:r}=(async(e,t)=>{if(!e||!t)return null;const n={url:m.api.profile+e+"/avatar",method:"PUT",credentials:"include",body:t};try{const{status:e,parsedJson:t}=await p(n);return 200===e?t.user_avatar:null}catch(e){return null}})(e,t);r&&this.eventBus.emit("profile:renderNewAvatar",r)}})),y(this,"updateProfileInfo",((e,t,n,r)=>{(async(e,t,n)=>{if(!e||!t||!n)return null;const r={url:m.api.profile+e,method:"PATCH",credentials:"include",body:JSON.stringify({email:t,username:n})};try{return 200===(await p(r)).status}catch(e){return!1}})(e,t,n).then((e=>{e&&this.eventBus.emit("profile:updateProfile",r)})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))})),y(this,"saveChanges",((e,t,n,r,s)=>{a(t)&&(n.value&&this.updateAvatar(e,n),this.updateProfileInfo(e,r,s,t))})),this.eventBus=e,this.eventBus.on("profile:getInfoAboutCurrentUser",this.getInfoAboutCurrentUser),this.eventBus.on("profile:getInfoForProfile",this.getInfoForProfile),this.eventBus.on("profile:saveChanges",this.saveChanges)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class P extends t{constructor(e,{data:t={}}={}){super(e,t),L(this,"render",(()=>{const e=puglatizer.components.Loader.Loader();U.innerHTML=e,this.eventBus.emit("profile:getInfoAboutCurrentUser"),this.eventBus.emit("homepage:InfoForHeader")})),L(this,"renderProfileInfo",(e=>{this._data={profileData:e};const t=puglatizer.components.ProfileContent.ProfileContent(this._data),n=document.querySelector(".content");n?n.innerHTML=t:this.eventBus.emit("homepage:renderErrorPage")})),L(this,"renderNewAvatar",(e=>{document.getElementById("avatar").src=e})),L(this,"updateProfile",(e=>{const[t]=document.getElementsByClassName("title-wrapper__nickname"),[n]=document.getElementsByClassName("input-wrapper__button"),r=e.querySelectorAll(".input-wrapper__input");t.textContent=document.getElementById("login").value,n.textContent="Редактировать",r.forEach((e=>{e.classList.add("input-wrapper__input_disabled"),e.disabled=!0}))})),L(this,"setEventListeners",(e=>{const t=document.getElementById("avatar"),[n]=document.getElementsByTagName("form"),[r]=document.getElementsByClassName("input-wrapper__button"),s=()=>{t.src="img/user.png"};t.addEventListener("error",s);const i=t=>{t.preventDefault();const s=n.querySelectorAll(".input-wrapper__input");if("Редактировать"===r.textContent)r.textContent="Сохранить",s.forEach((e=>{e.classList.remove("input-wrapper__input_disabled"),e.disabled=!1}));else if("Сохранить"===r.textContent){const t=document.getElementById("file"),r=document.getElementById("email").value,s=document.getElementById("login").value;this.eventBus.emit("profile:saveChanges",e,n,t,r,s)}};n?.addEventListener("submit",i),this.eventBus.on("profile:removeEventListeners",(()=>{n?.removeEventListener("submit",i),t.removeEventListener("error",s)}))})),this.eventBus.on("profile:render",this.render),this.eventBus.on("profile:renderProfileInfo",this.renderProfileInfo),this.eventBus.on("profile:setEventListeners",this.setEventListeners),this.eventBus.on("profile:renderNewAvatar",this.renderNewAvatar),this.eventBus.on("profile:updateProfile",this.updateProfile)}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class A{constructor(e){C(this,"getMainPageContent",(()=>{const e=(async()=>{const e={url:m.api.topFilmsAndSeries,method:"GET"};try{const{status:t,parsedJson:n}=await p(e);return 200===t?(e=>{const t=[];return e.reduce(((e,n)=>{t.push({id:n.id,title:n.title,description:n.description,movieAvatar:`${h}${n.movie_avatar}`,stars:"* ".repeat(n.rating),href:`/movie/${n.id}`})})),t})(n.top):null}catch(e){return null}})(),t=(async()=>{const e={url:m.api.newFilms,method:"GET"};try{const{status:t,parsedJson:n}=await p(e);return 200===t?v(n.newFilms):null}catch(e){return null}})(),n=(async()=>{const e={url:m.api.newSeries,method:"GET"};try{const{status:t,parsedJson:n}=await p(e);return 200===t?v(n.newSeries):null}catch(e){return null}})();Promise.all([e,t,n]).then((e=>{const[t,n,r]=e;this.eventBus.emit("homepage:renderContent",t,n,r),this.eventBus.emit("homepage:setEventListeners")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))})),C(this,"getInfoForHeader",(()=>{g().then((e=>{if(e){const e={isAuthorized:!0};this.eventBus.emit("homepage:renderHeader",e)}else{const e={isAuthorized:!1};this.eventBus.emit("homepage:renderHeader",e)}this.eventBus.emit("homepage:setEventListenersForHeader")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))})),C(this,"logout",(()=>{(async()=>{const e={url:m.api.logout,method:"GET",credentials:"include"};try{return 200===(await p(e)).status}catch(e){return!1}})().then((()=>{this.eventBus.emit("homepage:render")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))})),this.eventBus=e,this.eventBus.on("homepage:InfoForHeader",this.getInfoForHeader),this.eventBus.on("homepage:logout",this.logout),this.eventBus.on("homepage:getMainPageContent",this.getMainPageContent)}}var I=n(237),k=n.n(I);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class S extends t{constructor(e,{data:t={}}={}){super(e,t),F(this,"render",(()=>{const e=k()();U.innerHTML=e,this.eventBus.emit("homepage:InfoForHeader"),this.eventBus.emit("homepage:getMainPageContent")})),F(this,"renderHeader",(e=>{const t=puglatizer.components.Header.Header(e),[n]=document.getElementsByTagName("header");n?n.outerHTML=t:this.eventBus.emit("homepage:renderErrorPage")})),F(this,"renderContent",((e,t,n)=>{this._data={cardFilms:e,newFilms:t,newSeries:n};const r=puglatizer.components.HomeContent.HomeContent(this._data),s=document.querySelector(".content");s?s.innerHTML=r:this.eventBus.emit("homepage:renderErrorPage")})),F(this,"renderErrorPage",(()=>{const e=puglatizer.components.ErrorPage.ErrorPage();U.innerHTML=e})),F(this,"setEventListenersForHeader",(()=>{const e=()=>{this.eventBus.emit("homepage:removeEventListeners"),this.eventBus.emit("profile:removeEventListeners"),i?.removeEventListener("click",n),a?.removeEventListener("click",r),o?.removeEventListener("click",s),l?.removeEventListener("click",t)},t=e=>{this.eventBus.emit("homepage:removeEventListeners"),this.eventBus.emit("profile:removeEventListeners"),e.preventDefault(),this.eventBus.emit("homepage:getMainPageContent")},n=e=>{this.eventBus.emit("homepage:removeEventListeners"),this.eventBus.emit("profile:removeEventListeners"),e.preventDefault(),this.eventBus.emit("profile:getInfoAboutCurrentUser")},r=t=>{e(),t.preventDefault(),this.eventBus.emit("login:render")},s=t=>{e(),t.preventDefault(),this.eventBus.emit("homepage:logout")},i=document.querySelector(".js-profile-page");i?.addEventListener("click",n);const a=document.querySelector(".js-login-page");a?.addEventListener("click",r);const o=document.querySelector(".js-logout-page");o?.addEventListener("click",s);const[l]=document.getElementsByClassName("homePage");l?.addEventListener("click",t)})),F(this,"setEventListeners",(()=>{const e=e=>{window.scrollTo(0,0),i();const t=e.target.closest(".item__film-card");e.preventDefault(),t&&this.eventBus.emit("detailpage:getInfoAboutFilm",t.id.substr("top".length))},t=e=>{window.scrollTo(0,0),i();const t=e.target.closest(".item__internal");e.preventDefault(),t&&this.eventBus.emit("detailpage:getInfoAboutFilm",t.id.substr("suggest".length))},[n]=document.getElementsByClassName("container");n?.addEventListener("click",e);const[r]=document.getElementsByClassName("new_films");r?.addEventListener("click",t);const[s]=document.getElementsByClassName("new_series");s?.addEventListener("click",t);const i=()=>{n?.removeEventListener("click",e),s?.removeEventListener("click",t),r?.removeEventListener("click",t)};this.eventBus.on("homepage:removeEventListeners",i)})),this.eventBus.on("homepage:render",this.render),this.eventBus.on("homepage:renderHeader",this.renderHeader),this.eventBus.on("homepage:setEventListeners",this.setEventListeners),this.eventBus.on("homepage:setEventListenersForHeader",this.setEventListenersForHeader),this.eventBus.on("homepage:renderContent",this.renderContent),this.eventBus.on("homepage:renderErrorPage",this.renderErrorPage)}}class x{constructor(e){var t,n;n=e=>{(async e=>{const t={url:m.api.media+e,method:"GET"};try{const{status:e,parsedJson:n}=await p(t);return 200===e?(e=>{const t={movieAvatar:`${h}${e.movie_avatar}`,rating:e.rating?`Положительных оценок ${e.rating}`:""};return["title","type","year","genres","director","countries","actors","description"].forEach((n=>{t[n]=e[n]})),t})(n):null}catch(e){return null}})(e).then((e=>{e?this.eventBus.emit("detailpage:renderDetailsAboutFilm",e):this.eventBus.emit("homepage:renderErrorPage")})).catch((()=>{this.eventBus.emit("homepage:renderErrorPage")}))},(t="getInfoAboutFilm")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,this.eventBus=e,this.eventBus.on("detailpage:getInfoAboutFilm",this.getInfoAboutFilm)}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class H extends t{constructor(e,{data:t={}}={}){super(e,t),N(this,"render",((e={})=>{const t=puglatizer.components.Loader.Loader();U.innerHTML=t,this.eventBus.emit("detailpage:getInfoAboutFilm","1"),this.eventBus.emit("homepage:getCurrentUser")})),N(this,"renderDetailsAboutFilm",(e=>{this._data={filmData:e};const t=puglatizer.components.DetailForm.DetailForm(this._data),n=document.querySelector(".content");n?n.innerHTML=t:this.eventBus.emit("homepage:renderErrorPage")})),this.eventBus.on("detailpage:render",this.render),this.eventBus.on("detailpage:renderDetailsAboutFilm",this.renderDetailsAboutFilm)}}const T="/home",j="/signup",z="/login",D="/profile",O="\\/movie\\/\\d+",U=document.getElementById("app"),$=new class extends _{constructor(){super(new _),this.eventBus=e,this.model=new w(this.eventBus),this.view=new E(this.eventBus)}},M=new class extends _{constructor(){super(new _),this.eventBus=e,this.model=new f(this.eventBus),this.view=new i(this.eventBus)}},J=new class extends _{constructor(){super(new _),this.eventBus=e,this.model=new b(this.eventBus),this.view=new P(this.eventBus)}},q=new class extends _{constructor(){super(new _),this.eventBus=e,this.model=new A(this.eventBus),this.view=new S(this.eventBus)}},G=new class extends _{constructor(){super(new _),this.eventBus=e,this.model=new x(this.eventBus),this.view=new H(this.eventBus)}};new class{constructor(t){this.application=t,this.routes=[],this.currentController=null,e.on("pathChanged",this.onPathChanged.bind(this)),e.on("redirectBack",this.back.bind(this)),e.on("redirectForward",this.forward.bind(this)),document.getElementById("app").addEventListener("click",(e=>{e.target.dataset.routlink&&(e.preventDefault(),this.changeRoute(e.target.dataset.routlink))}))}register(e,t){let n={path:e,controller:t};return this.routes.push(n),this}onPathChanged(e){this.go(e.path,e||{})}start(){window.addEventListener("popstate",(()=>{this.go(window.location.pathname+window.location.search)})),this.go(window.location.pathname+window.location.search)}getRouteData(e){let t=null;const n=this.getParam(e);return console.log(n),this.routes.forEach((({path:e,controller:r})=>{n.path.match(e)&&(t=r)})),{controller:t,path:{path:n.path,resourceId:+n.pathParams}}}getParam(e){const t=new RegExp(/\d+/);return e.match(t),{path:new URL(window.location.origin+e).pathname,pathParams:null}}go(e,t={}){const n=this.getRouteData(e);t={...t,...n},this.currentController===n.controller&&console.log("Тот же контроллер"),this.currentController&&console.log("Проверка"),this.currentController=n.controller,this.currentController||(e=T,this.currentController=this.getRouteData(e).controller),window.location.pathname!==e&&window.history.pushState(null,null,e),this.currentController.view.render()}back(){window.history.back()}forward(){window.history.forward()}}(U).register(T,q).register(j,$).register(z,M).register(D,J).register(O,G).start()})()})();
//# sourceMappingURL=bundle.js.map